<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Unit Test Guidance • datacutr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Unit Test Guidance">
<meta property="og:description" content="datacutr">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">datacutr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/datacutr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">User Guides</li>
    <li>
      <a href="../articles/faq.html">FAQ</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Developer Guides</li>
    <li>
      <a href="../articles/contribution_model.html">Contribution to {datacutr}</a>
    </li>
    <li>
      <a href="../articles/development_process.html">Development Process</a>
    </li>
    <li>
      <a href="../articles/programming_strategy.html">Programming Strategy</a>
    </li>
    <li>
      <a href="../articles/git_usage.html">Guidance for git and GitHub Usage</a>
    </li>
    <li>
      <a href="../articles/writing_vignettes.html">Writing Vignettes</a>
    </li>
    <li>
      <a href="../articles/pr_review_guidance.html">Pull Request Review Guidance</a>
    </li>
    <li>
      <a href="../articles/unit_test_guidance.html">Unit Test Guidance</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pharmaverse/datacutr">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Unit Test Guidance</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pharmaverse/datacutr/blob/main/vignettes/unit_test_guidance.Rmd"><code>vignettes/unit_test_guidance.Rmd</code></a></small>
      <div class="hidden name"><code>unit_test_guidance.Rmd</code></div>

    </div>

    
    
<div id="why-write-unit-tests" class="section level1">
<h1 class="hasAnchor">
<a href="#why-write-unit-tests" class="anchor"></a>Why Write Unit Tests?</h1>
<div id="unit-tests-become-a-safety-net-for-developers" class="section level2">
<h2 class="hasAnchor">
<a href="#unit-tests-become-a-safety-net-for-developers" class="anchor"></a>Unit Tests Become a Safety Net for Developers</h2>
<p>A comprehensive suite of unit tests can act as a safety net for developers. By frequently running the tests, they can assure their recent modifications to the code haven’t broken anything. In other words, unit tests help prevent regressions.</p>
</div>
<div id="unit-tests-can-contribute-to-higher-code-quality" class="section level2">
<h2 class="hasAnchor">
<a href="#unit-tests-can-contribute-to-higher-code-quality" class="anchor"></a>Unit Tests Can Contribute to Higher Code Quality</h2>
<p>Since unit tests act as a safety net, developers become more confident when changing the code. They can refactor the code without fear of breaking things, driving the general quality of the code base up.</p>
</div>
<div id="unit-tests-can-contribute-to-better-application-architecture" class="section level2">
<h2 class="hasAnchor">
<a href="#unit-tests-can-contribute-to-better-application-architecture" class="anchor"></a>Unit Tests Can Contribute to Better Application Architecture</h2>
<p>If you can add unit tests easily to a code base, that’s usually a good sign regarding the quality of the app’s architecture. So, the drive to write testable code can be an incentive for better architecture.</p>
</div>
<div id="detects-code-smells-in-your-codebase" class="section level2">
<h2 class="hasAnchor">
<a href="#detects-code-smells-in-your-codebase" class="anchor"></a>Detects Code Smells in your Codebase</h2>
<p>If ease of adding unit tests to a code base is a good sign, the opposite is also true. Having a hard time creating unit tests for a given piece of code might be a sign of code smells in the code—e.g. functions that are too complex.</p>
</div>
</div>
<div id="writing-good-unit-tests" class="section level1">
<h1 class="hasAnchor">
<a href="#writing-good-unit-tests" class="anchor"></a>Writing Good Unit Tests</h1>
<div id="tests-should-be-fast" class="section level2">
<h2 class="hasAnchor">
<a href="#tests-should-be-fast" class="anchor"></a>Tests Should Be Fast</h2>
<p>If they’re slow, developers won’t run them as often as they should. That defeats the whole purpose of having a suite of unit tests in the first place, which is to boost the developers’ confidence to make changes to the code. The tests can’t work as the safety net if they’re not run often.</p>
</div>
<div id="tests-should-be-simple" class="section level2">
<h2 class="hasAnchor">
<a href="#tests-should-be-simple" class="anchor"></a>Tests Should Be Simple</h2>
<p>There are several techniques we can apply to have a high degree of confidence in the correctness of our tests. One of those is to keep your tests with low cyclomatic complexity. Cyclomatic complexity is a code metric that indicates the number of possible execution paths a given method can follow. A piece of code with lower complexity is easier to understand and maintain, which means developers are less likely to introduce bugs when working on it. We can measure the cyclomatic complexity of your tests (using, for instance, a linter tool) and do your best to keep it low.</p>
</div>
<div id="test-shouldnt-duplicate-implementation-logic" class="section level2">
<h2 class="hasAnchor">
<a href="#test-shouldnt-duplicate-implementation-logic" class="anchor"></a>Test Shouldn’t Duplicate Implementation Logic</h2>
<p>If the same person wrote both the test and the implementation, it’s possible they made the same errors in both places. Since the tests mirror the implementation, they might still pass, and the implementation could be wrong, but the tests might fool you into thinking otherwise. Resist the urge to make your tests fancy, keep them simple, and your testing suite will be better for it.</p>
</div>
<div id="tests-should-be-readable" class="section level2">
<h2 class="hasAnchor">
<a href="#tests-should-be-readable" class="anchor"></a>Tests Should Be Readable</h2>
<p>This best practice overlaps a little bit with the one about keeping your tests simple. If tests are hard to read, developers are more likely to misunderstand them and introduce bugs. Test cases could be used as a form of documentation, so they obviously need to be readable.</p>
</div>
<div id="running-unit-tests-part-of-the-build-process" class="section level2">
<h2 class="hasAnchor">
<a href="#running-unit-tests-part-of-the-build-process" class="anchor"></a>Running Unit Tests Part of the Build Process</h2>
<p>Automate the whole process of running the unit tests and taking some action when they fail. Your build process should execute your unit tests and mark the build as broken when the tests fail.</p>
</div>
</div>
<div id="writing-unit-tests-in-datacutr" class="section level1">
<h1 class="hasAnchor">
<a href="#writing-unit-tests-in-datacutr" class="anchor"></a>Writing Unit Tests in {datacutr}</h1>
<div id="plan-your-unit-tests" class="section level2">
<h2 class="hasAnchor">
<a href="#plan-your-unit-tests" class="anchor"></a>Plan your Unit Tests</h2>
<p>Start by considering the derivation rule you are testing and the possible arguments/flexibilities of your function code. Then plan which scenarios you will test. These can either involve generating different input test cases or feeding them into different calls of your function.</p>
</div>
<div id="test-coverage" class="section level2">
<h2 class="hasAnchor">
<a href="#test-coverage" class="anchor"></a>Test coverage</h2>
<p>Unit tests should cover the functionality of the function. If another function <code>g()</code> is called within a function <code>f()</code>, the unit tests of <code>f()</code> should not test the functionality of <code>g()</code>. This should be tested by the unit tests of <code>g()</code>, i.e. unit tests should be added at the lowest level.</p>
</div>
<div id="tests-should-be-robust-to-cover-realistic-data-scenarios" class="section level2">
<h2 class="hasAnchor">
<a href="#tests-should-be-robust-to-cover-realistic-data-scenarios" class="anchor"></a>Tests Should be Robust to Cover Realistic Data Scenarios</h2>
<p>For generating input test cases, it can be helpful to consider regular cases (expected common data scenarios), boundary cases (where data points are close or equal), and special cases (uncommon but valid data scenarios, e.g. missing or special characters). Although you will never cover every single eventuality of possible input data (no reliability testing method ever gives 100% certainty), you do need to give confidence that the code is robust enough to work across most data scenarios.</p>
</div>
<div id="testing-should-cover-possible-arguments" class="section level2">
<h2 class="hasAnchor">
<a href="#testing-should-cover-possible-arguments" class="anchor"></a>Testing Should Cover Possible Arguments</h2>
<p>For the different calls of your function, consider how the user might apply your function and test a variety of possible calls, whilst still remembering the tips above that tests should be fast and simple. This is only needed in cases where the complexity and level of flexibility of your function justifies it, e.g. see the test script: <a href="https://github.com/pharmaverse/admiral/blob/main/tests/testthat/test-derive_var_extreme_flag.R" class="uri">https://github.com/pharmaverse/admiral/blob/main/tests/testthat/test-derive_var_extreme_flag.R</a>.</p>
</div>
<div id="exported-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#exported-functions" class="anchor"></a>Exported Functions</h2>
<p>Don’t forget to add a unit test for each exported function.</p>
</div>
<div id="set-up-the-test-script" class="section level2">
<h2 class="hasAnchor">
<a href="#set-up-the-test-script" class="anchor"></a>Set up the Test Script</h2>
<p>Within {admiral} folder <a href="https://github.com/pharmaverse/admiral/tree/main/tests/testthat" class="uri">https://github.com/pharmaverse/admiral/tree/main/tests/testthat</a>, add a script with the naming convention “test-&lt;script_containing_function&gt;.R”., the unit test script can be created from the console also, as follows:</p>
<pre><code><a href="https://usethis.r-lib.org/reference/use_r.html">usethis::use_test("&lt;script_containing_function&gt;")</a></code></pre>
<p>the testing framework used is testthat and has the following format :</p>
<pre><code>test_that("&lt;function_name&gt; Test 1: &lt;Explanation of the test&gt;", {
  input &lt;- tibble::tribble(
    ~inputvar1, ~inputvar2, ...
    &lt;Add Test Data Scenarios&gt;
    ...
  )

  expected_output &lt;- mutate(input, outputvar = c(&lt;Add Expected Outputs&gt;))

  expect_dfs_equal(&lt;function name&gt;(input), expected_output)
  
})</code></pre>
<p>For example, if you are testing a function called my_new_func that is contained in script all_funcs.R then from console use:</p>
<pre><code><a href="https://usethis.r-lib.org/reference/use_r.html">usethis::use_test("all_funcs")</a></code></pre>
<p>Open the newly created file “test-all_funcs.R” and use the following format:</p>
<pre><code>test_that("my_new_func Test 1: &lt;Explanation of the test&gt;", {
  input &lt;- tibble::tribble(
    ~inputvar1, ~inputvar2, ...
    &lt;Add Test Data Scenarios&gt;
    ...
  )

  expected_output &lt;- mutate(input, outputvar = c(&lt;Add Expected Outputs&gt;))

  expect_dfs_equal(&lt;function name&gt;(input), expected_output)
})</code></pre>
<p><strong>Note</strong>: When comparing datasets in {admiral} we use function <code>expect_dfs_equal()</code>.</p>
<p>The input and expected output for the unit tests must follow the following rules:</p>
<ul>
<li>Input and output should be as simple as possible.</li>
<li>Values should be hard-coded whenever possible.</li>
<li>If values need to be derived, only unit tested functions can be used.</li>
</ul>
<p>If a dataset needs to be created for testing purpose, it should be done so using the function <code><a href="https://tibble.tidyverse.org/reference/tribble.html">tibble::tribble()</a></code>. Make sure to align columns as well. This ensures quick code readability.</p>
<p>Ensure you give a meaningful explanation of the test in the testthat call, as these will be compiled in the package validation report. Having the name of the function and test ID included in title will also help with traceability.</p>
<p>Once you have tested your unit test program, you can run all unit tests from the console, as follows.</p>
<pre><code><a href="https://devtools.r-lib.org/reference/test.html">devtools::test()</a></code></pre>
</div>
<div id="automation-of-unit-tests" class="section level2">
<h2 class="hasAnchor">
<a href="#automation-of-unit-tests" class="anchor"></a>Automation of Unit Tests</h2>
<p>When a user actions a pull request in {admiral} GitHub repo, the unit tests are automatically run and pull request will be denied if any unit tests fail.</p>
</div>
<div id="flow-chart" class="section level2">
<h2 class="hasAnchor">
<a href="#flow-chart" class="anchor"></a>Flow Chart</h2>
<p><img src="unit_test_guidance.png" width="120%"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Tim Barnett, Nathan Rees, Alana Harris.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '2d4895759f79e89d6eb1c3b990bca6d8',
    indexName: 'pharmaverse',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
